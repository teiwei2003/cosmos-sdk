# ADR 006:秘密存储更换

## 变更日志

- 2019 年 7 月 29 日:初稿
- 2019 年 9 月 11 日:工作已经开始
- 11 月 4 日:Cosmos SDK 更改合并
- 11 月 18 日:Gaia 更改合并

##  上下文

目前，Cosmos SDK 应用程序的 CLI 目录将密钥材料和元数据存储在用户主目录中的纯文本数据库中。密钥材料由密码加密，由 bcrypt 散列算法保护。元数据(例如地址、公钥、密钥存储详细信息)以纯文本形式提供。

出于多种原因，这是不可取的。也许最大的原因是关键材料和元数据的安全保护不足。泄露纯文本允许攻击者通过多种技术监视给定计算机控制的密钥，例如在没有任何特权执行的情况下破坏依赖项。随后可能会对特定用户/计算机进行更有针对性的攻击。

所有现代台式计算机操作系统(Ubuntu、Debian、MacOS、Windows)都提供了一个内置的秘密存储，旨在允许应用程序存储与所有其他应用程序隔离的信息，并且需要输入密码才能访问数据。

我们正在寻求解决方案，为许多不同的后端提供通用抽象层，并为不提供本机秘密存储的最小平台提供合理的回退。

## 决定

我们建议将当前基于 LevelDB 的 Keybase 后端替换为 [Keyring](https://github.com/99designs/keyring) by 99 design。此应用程序旨在提供许多秘密存储之间的通用抽象和统一接口，并由 AWS Vault 应用程序由 99-designs 应用程序使用。

这似乎满足了保护密钥材料和元数据免受用户机器上恶意软件攻击的要求。

## 状态

公认

## 结果

### 目的

为用户增加安全性。

### 消极的

用户必须手动迁移。

针对所有支持的后端进行测试很困难。

在 Mac 上本地运行测试需要多次重复输入密码。

### 中性的

{中立后果}

## 参考

- #4754 将秘密存储切换到密钥环秘密存储(@poldsam 的原始 PR)[__CLOSED__]
- #5029 添加对 github.com/99designs/keyring-backed 密钥库的支持 [__MERGED__]
- #5097 添加密钥迁移命令 [__MERGED__]
- #5180 删除磁盘密钥库以支持密钥环 [_PENDING_REVIEW_]
- cosmos/gaia#164 删除磁盘密钥库以支持密钥环(gaia 的更改)[_PENDING_REVIEW_] 