# ステーキングトゥームストーン

## 概要

`slashing`モジュールの現在の実装では、コンセンサスエンジンがステートマシンにバリデーターのコンセンサスフォールトを通知すると、バリデーターは部分的にスラッシュされ、許可されない期間である[jail期間]に入れられます。 バリデーターセットに再参加します。
ただし、コンセンサス障害とABCIの性質により、違反が発生してから、違反がステートマシンに到達するまでの間に遅延が発生する可能性があります(これが、非結合期間が存在する主な理由の1つです)。

> 注:トゥームストーンの概念は、間に遅延がある障害にのみ適用されます
> 違反が発生し、証拠がステートマシンに到達します。例えば、
> バリデーターの二重署名の証拠がステートマシンに到達するまでに時間がかかる場合があります
> 予測不可能な証拠により、ゴシップレイヤーの遅延とバリデーターの
> 二重署名を選択的に表示します(例:まれにオンラインのライトクライアント)。
> 一方、活力の大幅な削減は、
> 違反が発生するため、スラッシュ期間は必要ありません。バリデーターは
> すぐに刑務所に入れられ、彼らは別の活力の過ちを犯すことはできません
> 彼らが脱獄するまで。将来的には、他の種類のビザンチン将軍問題が発生する可能性があります
> 遅延がある(たとえば、無効な提案の証拠をトランザクションとして提出する)。
> 実装する場合、これらの将来のタイプが
> ビザンチン将軍問題は、墓石になります(そうでない場合は、スラッシュ量
> スラッシュ期間で制限されることはありません)。

現在のシステム設計では、コンセンサス障害のためにバリデーターが刑務所に入れられると、`JailPeriod`の後に、トランザクションを`unjail`に送信して、バリデーターセットに再参加することができます。。

[スラッシュ]モジュールの[設計上の要望]の1つは、複数の場合
違反は証拠が実行される前に発生し(そしてバリデーターが刑務所に入れられます)、それらは単一の最悪の違反に対してのみ罰せられるべきであり、累積的には罰せられません。
たとえば、イベントのシーケンスが次の場合:

1. バリデーターAが違反1をコミットします(30％のスラッシュに相当)
2. バリデーターAが違反2をコミットします(40％のスラッシュに相当)
3. バリデーターAが違反3をコミットします(35％のスラッシュに相当)
4. 違反1の証拠がステートマシンに到達します(そしてバリデーターが刑務所に入れられます)
5. 違反2の証拠がステートマシンに到達
6. 違反3の証拠がステートマシンに到達

Infraction 2が最も高いため、スラッシュを有効にする必要があります。 これが行われるため、バリデーターのコンセンサスキーが侵害された場合、ハッカーが多くのブロックに二重署名したとしても、それらは1回だけ罰せられます。
バリデーターのオペレーターキーを使用してアンジェイルを実行する必要があるため、コンセンサスキーを再保護してから、オペレーターキーを使用する準備ができたことを通知する機会があります。
最大違反のみを追跡するこの期間を[スラッシュ期間]と呼びます。

バリデーターが自分自身を解放することによって再び参加すると、新しいスラッシュ期間が始まります。
彼らが脱獄後に新たな違反を犯した場合、それは前の斬撃期間からの最悪の違反に加えて累積的に斬撃されます。

ただし、違反はスラッシュ期間に基づいてグループ化されますが、違反後は[unbondingPeriod]まで証拠を提出できるため、以前のスラッシュ期間の証拠を提出できるようにする必要があります。
たとえば、イベントのシーケンスが次の場合:

1. バリデーターAが違反1をコミットします(30％のスラッシュに相当)
2. バリデーターAが違反2をコミットします(40％のスラッシュに相当)
3. 違反1の証拠がステートマシンに到達します(そしてバリデーターAが刑務所に入れられます)
4. バリデーターAがジェイルを解除します

現在、新たな削減期間にありますが、違反2の証拠がまだ提出されている可能性があるため、前回の違反に対してはドアを開いたままにしておく必要があります。
スラッシュ期間の数が増えると、単一のスラッシュ期間ごとに最大の違反量を追跡する必要があるため、複雑さが増します。

> 注:現在、 `slashing`モジュールの仕様によると、新しいスラッシュ期間
> は、バリデーターが結合解除されてから再結合されるたびに作成されます。 これはおそらく
> jailed/unjailedに変更されます。 問題[#3205](https://github.com/cosmos/cosmos-sdk/issues/3205)を参照してください
> 詳細については。 これの残りの間、私は私たちが始めるだけであると仮定します
>バリデーターがジェイル解除される新しいスラッシュ期間。

スラッシュ期間の最大数は `len(UnbondingPeriod)/len(JailPeriod)`です。
`UnbondingPeriod`と` JailPeriod`のガイアの現在のデフォルトはそれぞれ3週間と2日です。 これは、バリデーターごとに最大11のスラッシュ期間が同時に追跡される可能性があることを意味します。 `JailPeriod> = UnbondingPeriod`を設定すると、
1つのスラッシュ期間のみを追跡する必要があります(つまり、スラッシュ期間を追跡する必要はありません)。

現在、刑務所期間の実装では、バリデーターが刑務所を解くと、彼らに委任された(非結合/再委任されていない)すべての委任者は彼らと一緒にいます。 コンセンサスの安全性の障害が非常にひどい(活気の障害よりもはるかに)ことを考えると、バリデーターに[自動再結合]しない委任者を配置することはおそらく賢明です。

### Proposal: infinite jail

コンセンサス安全障害を犯したバリデーターの[刑務所時間]を[無限](つまり、墓石の状態)に設定することを提案します。
これは基本的にバリデーターをバリデーターセットから追い出し、バリデーターセットに再び入ることを許可しません。 すべての委任者(オペレーター自身を含む)は、結合を解除するか、再委任する必要があります。
バリデーターオペレーターは、必要に応じて、新しいオペレーターキーとコンセンサスキーを使用して新しいバリデーターを作成できますが、委任を[再取得]する必要があります。

トゥームストーンシステムを実装し、スラッシュ期間の追跡を取り除くと、特に[ステーキング]モジュールによって消費される[スラッシュ]モジュールで定義されたすべてのフックを削除できるため、[スラッシュ]モジュールがはるかに簡単になります。
( `slashing`モジュールはまだ` stakeing`で定義されたフックを消費します)。

### Single slashing amount

実行できるもう1つの最適化は、テンダーミントコンセンサスのすべてのABCIフォールトが同じレベルでスラッシュされていると仮定した場合、[最大スラッシュ]を追跡する必要がないことです。
ABCI障害が発生すると、将来の潜在的な障害を比較して最大値を見つけることを心配する必要はありません。

現在、TendermintABCIの唯一の障害は次のとおりです。

- 不当な事前コミット(二重標識)

現在、近い将来、次の障害が含まれる予定です。

- ボンディング解除フェーズにあるときに事前コミットに署名する(軽いクライアントの二等分線を安全にするために必要)

これらの断層は両方ともビザンチン断層に起因することを考えると、私たちはそれらを等しく削減したいと思うでしょう、そしてそれで私たちは上記の変更を制定することができます。。

> 注:この変更は、現在のテンダーミントのコンセンサスには意味があるかもしれませんが、おそらく
> 異なるコンセンサスアルゴリズムまたはTendermintの将来のバージョンではありません
> さまざまなレベルで罰したい場合があります(たとえば、部分的なスラッシュ)。